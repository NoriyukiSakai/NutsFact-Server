<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.nines.nutsfact.infrastructure.mapper.FoodRawMaterialMapper">

    <!-- 基本栄養成分のResultMap -->
    <resultMap id="nutritionBasicResult" type="com.nines.nutsfact.domain.model.nutrition.NutritionBasic">
        <result property="refuse" column="refuse"/>
        <result property="refuseFlag" column="refuse_flag"/>
        <result property="enerc" column="enerc"/>
        <result property="enercFlag" column="enerc_flag"/>
        <result property="enercKcal" column="enerc_kcal"/>
        <result property="enercKcalFlag" column="enerc_kcal_flag"/>
        <result property="water" column="water"/>
        <result property="waterFlag" column="water_flag"/>
        <result property="prot" column="prot"/>
        <result property="protFlag" column="prot_flag"/>
        <result property="protcaa" column="protcaa"/>
        <result property="protcaaFlag" column="protcaa_flag"/>
        <result property="fat" column="fat"/>
        <result property="fatFlag" column="fat_flag"/>
        <result property="fatnlea" column="fatnlea"/>
        <result property="fatnleaFlag" column="fatnlea_flag"/>
        <result property="chole" column="chole"/>
        <result property="choleFlag" column="chole_flag"/>
        <result property="chocdf" column="chocdf"/>
        <result property="chocdfFlag" column="chocdf_flag"/>
        <result property="choavlm" column="choavlm"/>
        <result property="choavlmFlag" column="choavlm_flag"/>
        <result property="choavlmMark" column="choavlm_mark"/>
        <result property="choavl" column="choavl"/>
        <result property="choavlFlag" column="choavl_flag"/>
        <result property="choavldf" column="choavldf"/>
        <result property="choavldfFlag" column="choavldf_flag"/>
        <result property="choavldfMark" column="choavldf_mark"/>
        <result property="fib" column="fib"/>
        <result property="fibFlag" column="fib_flag"/>
        <result property="polyl" column="polyl"/>
        <result property="polylFlag" column="polyl_flag"/>
        <result property="oa" column="oa"/>
        <result property="oaFlag" column="oa_flag"/>
        <result property="ash" column="ash"/>
        <result property="ashFlag" column="ash_flag"/>
        <result property="alc" column="alc"/>
        <result property="alcFlag" column="alc_flag"/>
        <result property="naclEq" column="nacl_eq"/>
        <result property="naclEqFlag" column="nacl_eq_flag"/>
    </resultMap>

    <!-- ミネラルのResultMap -->
    <resultMap id="nutritionMineralsResult" type="com.nines.nutsfact.domain.model.nutrition.NutritionMinerals">
        <result property="na" column="na"/>
        <result property="naFlag" column="na_flag"/>
        <result property="k" column="k"/>
        <result property="kFlag" column="k_flag"/>
        <result property="ca" column="ca"/>
        <result property="caFlag" column="ca_flag"/>
        <result property="mg" column="mg"/>
        <result property="mgFlag" column="mg_flag"/>
        <result property="p" column="p"/>
        <result property="pFlag" column="p_flag"/>
        <result property="fe" column="fe"/>
        <result property="feFlag" column="fe_flag"/>
        <result property="zn" column="zn"/>
        <result property="znFlag" column="zn_flag"/>
        <result property="cu" column="cu"/>
        <result property="cuFlag" column="cu_flag"/>
        <result property="mn" column="mn"/>
        <result property="mnFlag" column="mn_flag"/>
        <result property="idd" column="id"/>
        <result property="iddFlag" column="id_flag"/>
        <result property="se" column="se"/>
        <result property="seFlag" column="se_flag"/>
        <result property="cr" column="cr"/>
        <result property="crFlag" column="cr_flag"/>
        <result property="mo" column="mo"/>
        <result property="moFlag" column="mo_flag"/>
    </resultMap>

    <!-- ビタミンのResultMap -->
    <resultMap id="nutritionVitaminsResult" type="com.nines.nutsfact.domain.model.nutrition.NutritionVitamins">
        <result property="ret" column="ret"/>
        <result property="retFlag" column="ret_flag"/>
        <result property="carta" column="carta"/>
        <result property="cartaFlag" column="carta_flag"/>
        <result property="cartb" column="cartb"/>
        <result property="cartbFlag" column="cartb_flag"/>
        <result property="crypxb" column="crypxb"/>
        <result property="crypxbFlag" column="crypxb_flag"/>
        <result property="cartbeq" column="cartbeq"/>
        <result property="cartbeqFlag" column="cartbeq_flag"/>
        <result property="vitaRae" column="vita_rae"/>
        <result property="vitaRaeFlag" column="vita_rae_flag"/>
        <result property="vitd" column="vitd"/>
        <result property="vitdFlag" column="vitd_flag"/>
        <result property="tocpha" column="tocpha"/>
        <result property="tocphaFlag" column="tocpha_flag"/>
        <result property="tocphb" column="tocphb"/>
        <result property="tocphbFlag" column="tocphb_flag"/>
        <result property="tocphg" column="tocphg"/>
        <result property="tocphgFlag" column="tocphg_flag"/>
        <result property="tocphd" column="tocphd"/>
        <result property="tocphdFlag" column="tocphd_flag"/>
        <result property="vitk" column="vitk"/>
        <result property="vitkFlag" column="vitk_flag"/>
        <result property="thia" column="thia"/>
        <result property="thiaFlag" column="thia_flag"/>
        <result property="ribf" column="ribf"/>
        <result property="ribfFlag" column="ribf_flag"/>
        <result property="nia" column="nia"/>
        <result property="niaFlag" column="nia_flag"/>
        <result property="niac" column="niac"/>
        <result property="niacFlag" column="niac_flag"/>
        <result property="vitb6a" column="vitb6a"/>
        <result property="vitb6aFlag" column="vitb6a_flag"/>
        <result property="vitb12" column="vitb12"/>
        <result property="vitb12Flag" column="vitb12_flag"/>
        <result property="fol" column="fol"/>
        <result property="folFlag" column="fol_flag"/>
        <result property="pantac" column="pantac"/>
        <result property="pantacFlag" column="pantac_flag"/>
        <result property="biot" column="biot"/>
        <result property="biotFlag" column="biot_flag"/>
        <result property="vitc" column="vitc"/>
        <result property="vitcFlag" column="vitc_flag"/>
    </resultMap>

    <!-- 原材料のResultMap -->
    <resultMap id="foodRawMaterialResult" type="com.nines.nutsfact.domain.model.FoodRawMaterial">
        <id property="foodId" column="food_id"/>
        <result property="businessAccountId" column="business_account_id"/>
        <result property="foodNo" column="food_no"/>
        <result property="foodGroupId" column="food_group_id"/>
        <result property="indexNo" column="index_no"/>
        <result property="classCategoryId" column="class_category_id"/>
        <result property="originalFoodId" column="original_food_id"/>
        <result property="originalFoodGroupId" column="original_food_group_id"/>
        <result property="originalFoodNo" column="original_food_no"/>
        <result property="originalIndexNo" column="original_index_no"/>
        <result property="originalFoodName" column="original_food_name"/>
        <result property="foodName" column="food_name"/>
        <result property="foodFukuBunrui" column="food_fuku_bunrui"/>
        <result property="foodRuiKubun" column="food_rui_kubun"/>
        <result property="foodDaiBunrui" column="food_dai_bunrui"/>
        <result property="foodCyuBunrui" column="food_cyu_bunrui"/>
        <result property="foodSyoBunrui" column="food_syo_bunrui"/>
        <result property="foodSaibun" column="food_saibun"/>
        <result property="categoryId" column="category_id"/>
        <result property="hashtag" column="hashtag"/>
        <result property="compositeRawMaterialsKb" column="composite_raw_materials_kb"/>
        <result property="pricePerUnit" column="price_per_unit"/>
        <result property="makerId" column="maker_id"/>
        <result property="makerName" column="maker_name"/>
        <result property="sellerId" column="saller_id"/>
        <result property="sellerName" column="saller_name"/>
        <result property="compositeRawItemlist" column="composite_raw_itemlist"/>
        <result property="displayName" column="display_name"/>
        <result property="placeOfOrigin" column="place_of_origin"/>
        <result property="displayPlaceOfOrigin" column="display_place_of_origin"/>
        <result property="revisionOfFoodNo" column="revision_of_food_no"/>
        <result property="nextFoodId" column="next_food_id"/>
        <result property="expireDate" column="expire_date"/>
        <result property="createDate" column="create_date"/>
        <result property="lastUpdateDate" column="last_update_date"/>
        <result property="status" column="status"/>
        <result property="updateInformation" column="update_information"/>
        <result property="description" column="description"/>
        <result property="descriptionFlag" column="description_flag"/>
        <result property="isActive" column="is_active"/>
        <association property="basicNutrition" resultMap="nutritionBasicResult"/>
        <association property="minerals" resultMap="nutritionMineralsResult"/>
        <association property="vitamins" resultMap="nutritionVitaminsResult"/>
    </resultMap>

    <sql id="selectColumns">
        food_id, business_account_id, food_no, food_group_id, index_no, class_category_id,
        original_food_id, original_food_group_id, original_food_no, original_index_no, original_food_name,
        food_name, food_fuku_bunrui, food_rui_kubun, food_dai_bunrui, food_cyu_bunrui, food_syo_bunrui, food_saibun,
        category_id, hashtag, composite_raw_materials_kb, price_per_unit,
        maker_id, maker_name, saller_id, saller_name,
        composite_raw_itemlist, display_name, place_of_origin, display_place_of_origin,
        revision_of_food_no, next_food_id, expire_date, create_date, last_update_date,
        status, update_information, description, description_flag, is_active,
        refuse, refuse_flag, enerc, enerc_flag, enerc_kcal, enerc_kcal_flag, water, water_flag,
        protcaa, protcaa_flag, prot, prot_flag, fatnlea, fatnlea_flag, chole, chole_flag, fat, fat_flag,
        choavlm, choavlm_flag, choavlm_mark, choavl, choavl_flag, choavldf, choavldf_flag, choavldf_mark,
        fib, fib_flag, polyl, polyl_flag, chocdf, chocdf_flag, oa, oa_flag, ash, ash_flag,
        na, na_flag, k, k_flag, ca, ca_flag, mg, mg_flag, p, p_flag, fe, fe_flag, zn, zn_flag,
        cu, cu_flag, mn, mn_flag, id, id_flag, se, se_flag, cr, cr_flag, mo, mo_flag,
        ret, ret_flag, carta, carta_flag, cartb, cartb_flag, crypxb, crypxb_flag, cartbeq, cartbeq_flag, vita_rae, vita_rae_flag,
        vitd, vitd_flag, tocpha, tocpha_flag, tocphb, tocphb_flag, tocphg, tocphg_flag, tocphd, tocphd_flag,
        vitk, vitk_flag, thia, thia_flag, ribf, ribf_flag, nia, nia_flag, niac, niac_flag,
        vitb6a, vitb6a_flag, vitb12, vitb12_flag, fol, fol_flag, pantac, pantac_flag, biot, biot_flag,
        vitc, vitc_flag, alc, alc_flag, nacl_eq, nacl_eq_flag
    </sql>

    <select id="findAll" resultMap="foodRawMaterialResult">
        SELECT <include refid="selectColumns"/>
        FROM VFOOD_RAW_MATERIALS
    </select>

    <select id="findByCategory" resultMap="foodRawMaterialResult">
        SELECT <include refid="selectColumns"/>
        FROM VFOOD_RAW_MATERIALS
        WHERE category_id = #{categoryId}
    </select>

    <!-- ビジネスアカウントIDとカテゴリで原材料を取得 -->
    <select id="findByCategoryAndBusinessAccountId" resultMap="foodRawMaterialResult">
        SELECT <include refid="selectColumns"/>
        FROM VFOOD_RAW_MATERIALS
        WHERE category_id = #{categoryId}
        <if test="businessAccountId != null">
            AND business_account_id = #{businessAccountId}
        </if>
    </select>

    <!-- ビジネスアカウントIDで原材料を取得 -->
    <select id="findByBusinessAccountId" resultMap="foodRawMaterialResult">
        SELECT <include refid="selectColumns"/>
        FROM VFOOD_RAW_MATERIALS
        WHERE business_account_id = #{businessAccountId}
    </select>

    <select id="findSelectItems" resultType="com.nines.nutsfact.domain.model.SelectItem">
        SELECT food_id as id, food_name as name, food_no as no, IFNULL(maker_name, '') as description
        FROM VFOOD_RAW_MATERIALS
        <where>
            <if test="categoryId != null">
                category_id = #{categoryId}
            </if>
        </where>
    </select>

    <select id="findById" resultMap="foodRawMaterialResult">
        SELECT <include refid="selectColumns"/>
        FROM VFOOD_RAW_MATERIALS
        WHERE food_id = #{id}
    </select>

    <!-- IDとビジネスアカウントIDで原材料を取得（categoryId=1,2は除外可能） -->
    <select id="findByIdAndBusinessAccountId" resultMap="foodRawMaterialResult">
        SELECT <include refid="selectColumns"/>
        FROM VFOOD_RAW_MATERIALS
        WHERE food_id = #{id}
        <if test="businessAccountId != null">
            AND (category_id IN (1, 2) OR business_account_id = #{businessAccountId})
        </if>
    </select>

    <select id="findByFoodNo" resultMap="foodRawMaterialResult">
        SELECT <include refid="selectColumns"/>
        FROM VFOOD_RAW_MATERIALS
        WHERE food_no = #{foodNo}
    </select>

    <select id="getLastInsertId" resultType="Integer">
        SELECT LAST_INSERT_ID()
    </select>

    <insert id="insert" useGeneratedKeys="true" keyProperty="entity.foodId">
        INSERT INTO FOOD_RAW_MATERIALS (
            business_account_id, food_no, food_group_id, index_no, class_category_id,
            original_food_id, original_food_group_id, original_food_no, original_index_no,
            food_name, food_fuku_bunrui, food_rui_kubun, food_dai_bunrui, food_cyu_bunrui, food_syo_bunrui, food_saibun,
            original_food_name, category_id, hashtag, composite_raw_materials_kb, price_per_unit,
            maker_id, saller_id, composite_raw_itemlist, display_name, place_of_origin, display_place_of_origin,
            revision_of_food_no, next_food_id, expire_date, status, update_information, description, description_flag, is_active,
            refuse, refuse_flag, enerc, enerc_flag, enerc_kcal, enerc_kcal_flag, water, water_flag,
            protcaa, protcaa_flag, prot, prot_flag, fatnlea, fatnlea_flag, chole, chole_flag, fat, fat_flag,
            choavlm, choavlm_flag, choavlm_mark, choavl, choavl_flag, choavldf, choavldf_flag, choavldf_mark,
            fib, fib_flag, polyl, polyl_flag, chocdf, chocdf_flag, oa, oa_flag, ash, ash_flag,
            na, na_flag, k, k_flag, ca, ca_flag, mg, mg_flag, p, p_flag, fe, fe_flag, zn, zn_flag,
            cu, cu_flag, mn, mn_flag, id, id_flag, se, se_flag, cr, cr_flag, mo, mo_flag,
            ret, ret_flag, carta, carta_flag, cartb, cartb_flag, crypxb, crypxb_flag, cartbeq, cartbeq_flag, vita_rae, vita_rae_flag,
            vitd, vitd_flag, tocpha, tocpha_flag, tocphb, tocphb_flag, tocphg, tocphg_flag, tocphd, tocphd_flag,
            vitk, vitk_flag, thia, thia_flag, ribf, ribf_flag, nia, nia_flag, niac, niac_flag,
            vitb6a, vitb6a_flag, vitb12, vitb12_flag, fol, fol_flag, pantac, pantac_flag, biot, biot_flag,
            vitc, vitc_flag, alc, alc_flag, nacl_eq, nacl_eq_flag
        ) VALUES (
            #{entity.businessAccountId}, #{entity.foodNo}, #{entity.foodGroupId}, #{entity.indexNo}, #{entity.classCategoryId},
            #{entity.originalFoodId}, #{entity.originalFoodGroupId}, #{entity.originalFoodNo}, #{entity.originalIndexNo},
            #{entity.foodName}, #{entity.foodFukuBunrui}, #{entity.foodRuiKubun}, #{entity.foodDaiBunrui},
            #{entity.foodCyuBunrui}, #{entity.foodSyoBunrui}, #{entity.foodSaibun},
            #{entity.originalFoodName}, #{entity.categoryId}, #{entity.hashtag},
            #{entity.compositeRawMaterialsKb}, #{entity.pricePerUnit},
            #{entity.makerId}, #{entity.sellerId}, #{entity.compositeRawItemlist}, #{entity.displayName},
            #{entity.placeOfOrigin}, #{entity.displayPlaceOfOrigin},
            #{entity.revisionOfFoodNo}, #{entity.nextFoodId}, #{entity.expireDate},
            #{entity.status}, #{entity.updateInformation}, #{entity.description}, #{entity.descriptionFlag}, #{entity.isActive},
            #{entity.basicNutrition.refuse}, #{entity.basicNutrition.refuseFlag},
            #{entity.basicNutrition.enerc}, #{entity.basicNutrition.enercFlag},
            #{entity.basicNutrition.enercKcal}, #{entity.basicNutrition.enercKcalFlag},
            #{entity.basicNutrition.water}, #{entity.basicNutrition.waterFlag},
            #{entity.basicNutrition.protcaa}, #{entity.basicNutrition.protcaaFlag},
            #{entity.basicNutrition.prot}, #{entity.basicNutrition.protFlag},
            #{entity.basicNutrition.fatnlea}, #{entity.basicNutrition.fatnleaFlag},
            #{entity.basicNutrition.chole}, #{entity.basicNutrition.choleFlag},
            #{entity.basicNutrition.fat}, #{entity.basicNutrition.fatFlag},
            #{entity.basicNutrition.choavlm}, #{entity.basicNutrition.choavlmFlag}, #{entity.basicNutrition.choavlmMark},
            #{entity.basicNutrition.choavl}, #{entity.basicNutrition.choavlFlag},
            #{entity.basicNutrition.choavldf}, #{entity.basicNutrition.choavldfFlag}, #{entity.basicNutrition.choavldfMark},
            #{entity.basicNutrition.fib}, #{entity.basicNutrition.fibFlag},
            #{entity.basicNutrition.polyl}, #{entity.basicNutrition.polylFlag},
            #{entity.basicNutrition.chocdf}, #{entity.basicNutrition.chocdfFlag},
            #{entity.basicNutrition.oa}, #{entity.basicNutrition.oaFlag},
            #{entity.basicNutrition.ash}, #{entity.basicNutrition.ashFlag},
            #{entity.minerals.na}, #{entity.minerals.naFlag},
            #{entity.minerals.k}, #{entity.minerals.kFlag},
            #{entity.minerals.ca}, #{entity.minerals.caFlag},
            #{entity.minerals.mg}, #{entity.minerals.mgFlag},
            #{entity.minerals.p}, #{entity.minerals.pFlag},
            #{entity.minerals.fe}, #{entity.minerals.feFlag},
            #{entity.minerals.zn}, #{entity.minerals.znFlag},
            #{entity.minerals.cu}, #{entity.minerals.cuFlag},
            #{entity.minerals.mn}, #{entity.minerals.mnFlag},
            #{entity.minerals.idd}, #{entity.minerals.iddFlag},
            #{entity.minerals.se}, #{entity.minerals.seFlag},
            #{entity.minerals.cr}, #{entity.minerals.crFlag},
            #{entity.minerals.mo}, #{entity.minerals.moFlag},
            #{entity.vitamins.ret}, #{entity.vitamins.retFlag},
            #{entity.vitamins.carta}, #{entity.vitamins.cartaFlag},
            #{entity.vitamins.cartb}, #{entity.vitamins.cartbFlag},
            #{entity.vitamins.crypxb}, #{entity.vitamins.crypxbFlag},
            #{entity.vitamins.cartbeq}, #{entity.vitamins.cartbeqFlag},
            #{entity.vitamins.vitaRae}, #{entity.vitamins.vitaRaeFlag},
            #{entity.vitamins.vitd}, #{entity.vitamins.vitdFlag},
            #{entity.vitamins.tocpha}, #{entity.vitamins.tocphaFlag},
            #{entity.vitamins.tocphb}, #{entity.vitamins.tocphbFlag},
            #{entity.vitamins.tocphg}, #{entity.vitamins.tocphgFlag},
            #{entity.vitamins.tocphd}, #{entity.vitamins.tocphdFlag},
            #{entity.vitamins.vitk}, #{entity.vitamins.vitkFlag},
            #{entity.vitamins.thia}, #{entity.vitamins.thiaFlag},
            #{entity.vitamins.ribf}, #{entity.vitamins.ribfFlag},
            #{entity.vitamins.nia}, #{entity.vitamins.niaFlag},
            #{entity.vitamins.niac}, #{entity.vitamins.niacFlag},
            #{entity.vitamins.vitb6a}, #{entity.vitamins.vitb6aFlag},
            #{entity.vitamins.vitb12}, #{entity.vitamins.vitb12Flag},
            #{entity.vitamins.fol}, #{entity.vitamins.folFlag},
            #{entity.vitamins.pantac}, #{entity.vitamins.pantacFlag},
            #{entity.vitamins.biot}, #{entity.vitamins.biotFlag},
            #{entity.vitamins.vitc}, #{entity.vitamins.vitcFlag},
            #{entity.basicNutrition.alc}, #{entity.basicNutrition.alcFlag},
            #{entity.basicNutrition.naclEq}, #{entity.basicNutrition.naclEqFlag}
        )
    </insert>

    <update id="update">
        UPDATE FOOD_RAW_MATERIALS SET
            food_no = #{entity.foodNo},
            food_group_id = #{entity.foodGroupId},
            index_no = #{entity.indexNo},
            class_category_id = #{entity.classCategoryId},
            original_food_id = #{entity.originalFoodId},
            original_food_group_id = #{entity.originalFoodGroupId},
            original_food_no = #{entity.originalFoodNo},
            original_index_no = #{entity.originalIndexNo},
            food_name = #{entity.foodName},
            food_fuku_bunrui = #{entity.foodFukuBunrui},
            food_rui_kubun = #{entity.foodRuiKubun},
            food_dai_bunrui = #{entity.foodDaiBunrui},
            food_cyu_bunrui = #{entity.foodCyuBunrui},
            food_syo_bunrui = #{entity.foodSyoBunrui},
            food_saibun = #{entity.foodSaibun},
            original_food_name = #{entity.originalFoodName},
            category_id = #{entity.categoryId},
            hashtag = #{entity.hashtag},
            composite_raw_materials_kb = #{entity.compositeRawMaterialsKb},
            price_per_unit = #{entity.pricePerUnit},
            maker_id = #{entity.makerId},
            saller_id = #{entity.sellerId},
            composite_raw_itemlist = #{entity.compositeRawItemlist},
            display_name = #{entity.displayName},
            place_of_origin = #{entity.placeOfOrigin},
            display_place_of_origin = #{entity.displayPlaceOfOrigin},
            revision_of_food_no = #{entity.revisionOfFoodNo},
            next_food_id = #{entity.nextFoodId},
            expire_date = #{entity.expireDate},
            status = #{entity.status},
            update_information = #{entity.updateInformation},
            description = #{entity.description},
            description_flag = #{entity.descriptionFlag},
            is_active = #{entity.isActive}
        WHERE food_id = #{entity.foodId}
        <if test="entity.businessAccountId != null">
            AND business_account_id = #{entity.businessAccountId}
        </if>
    </update>

    <delete id="delete">
        DELETE FROM FOOD_RAW_MATERIALS WHERE food_id = #{id}
    </delete>

    <!-- ビジネスアカウントIDを条件に含む削除 -->
    <delete id="deleteByIdAndBusinessAccountId">
        DELETE FROM FOOD_RAW_MATERIALS
        WHERE food_id = #{id}
        <if test="businessAccountId != null">
            AND business_account_id = #{businessAccountId}
        </if>
    </delete>
</mapper>
